<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>AWS Lambda CloudWatch Logging &#8211; Holger Reinhardt</title>
<meta name="description" content="How to group AWS Lambda Logs by RequestId">
<meta name="keywords" content="development, aws">


<!-- Twitter Cards -->
<meta name="twitter:title" content="AWS Lambda CloudWatch Logging">
<meta name="twitter:description" content="How to group AWS Lambda Logs by RequestId">
<meta name="twitter:site" content="@hlgr360">
<meta name="twitter:creator" content="@hlgr360">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hlgr360.github.io/blog/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS Lambda CloudWatch Logging">
<meta property="og:description" content="How to group AWS Lambda Logs by RequestId">
<meta property="og:url" content="https://hlgr360.github.io/blog/blog/aws-logging/">
<meta property="og:site_name" content="Holger Reinhardt">





<link rel="canonical" href="https://hlgr360.github.io/blog/blog/aws-logging/">
<link href="https://hlgr360.github.io/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Holger Reinhardt Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://hlgr360.github.io/blog/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="https://hlgr360.github.io/blog/assets/js/vendor/html5shiv.min.js"></script>
  <script src="https://hlgr360.github.io/blog/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://hlgr360.github.io/blog/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://hlgr360.github.io/blog/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://hlgr360.github.io/blog/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://hlgr360.github.io/blog/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://hlgr360.github.io/blog/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://hlgr360.github.io/blog/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hlgr360.github.io/blog/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="https://hlgr360.github.io/blog/about/" >About</a></li>
		  
		    
		    <li><a href="https://hlgr360.github.io/blog/blog/" >Blog</a></li>
		  
		    
		    <li><a href="https://hlgr360.github.io/blog/tags/" >Tags</a></li>
		  
		    
		    <li><a href="https://hlgr360.github.io/blog/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="https://hlgr360.github.io/blog/" class="site-logo" rel="home" title="Holger Reinhardt"><img src="https://hlgr360.github.io/blog/images/site-logo.png" width="200" height="200" alt="Holger Reinhardt logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="https://hlgr360.github.io/blog/">Holger Reinhardt</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">I love building products.</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="https://hlgr360.github.io/blog/tags/#development" title="Pages tagged development">development</a></li><li><a href="https://hlgr360.github.io/blog/tags/#aws" title="Pages tagged aws">aws</a></li>
        </ul>
        
          <h1 class="entry-title">AWS Lambda CloudWatch Logging</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="https://hlgr360.github.io/blog/images/hlgr360.jpg" class="bio-photo" alt="Holger Reinhardt bio photo"/>
        
        <span class="author vcard">By <span class="fn">Holger Reinhardt</span></span>
        <span class="entry-date date published"><time datetime="2019-10-29T00:00:00+00:00"><i class="fa fa-calendar-o"></i> October 29, 2019</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-linkedin">
  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://hlgr360.github.io/blog/blog/aws-logging/" title="Share on LinkedIn" itemprop="LinkedIn"><i class="fa fa-linkedin-square"></i> Share</a>
</span>
<span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=development,aws&amp;text=AWS%20Lambda%20CloudWatch%20Logging&amp;url=https://hlgr360.github.io/blog/blog/aws-logging/&amp;via=hlgr360" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=https://hlgr360.github.io/blog/blog/aws-logging/" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=https://hlgr360.github.io/blog/blog/aws-logging/" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <p>AWS does an awesome job in documenting its services and APIs, no questions about it. But during my quest of building Microservices Architecture on AWS Lambda I keep encountering those ‘places in between’, when using AWS Lambda together with other AWS Services just drops me into rabbit hole of trying to find the missing nuggets of knowledge or code samples to make things actually work together.</p>

<p>So today’s blog post is about debugging. Just plain old debugging. Nothing fancy, just plain old <code class="highlighter-rouge">console.log()</code> will do the trick. So you add your logs, deploy your lambda and head over to the CloudWatch console to nail that nasty lambda timeout bug which keeps you up at night.</p>

<p>Lets say you are not just playing but have a constant stream of function invocations .. so I bet you quickly hit upon to type ‘Task timed out’ in the search bar above the log stream, and bang - you see all the timed out lambdas. So far so good. Except it is only the last line of that lambda invocation which matches your expression.</p>

<p>But not to despair - you might have noticed that each Lambda invocations is framed in a START, END and REPORT log, which includes a <code class="highlighter-rouge">RequestId</code> unique to that invocation. And each log generated from within the lambda code also has the <code class="highlighter-rouge">RequestId</code>prepended. So surely I should be able to type that <code class="highlighter-rouge">RequestId</code> value into the search and see all logs generated by that function invocation.  Makes total sense, or? Thought so?</p>

<p>You are so wrong (like me) :). Yep, searching for the RequestId in the CloudWatch console does <strong>nada, nothing, nichts</strong>. No log, no game.</p>

<p>Next step deeper into the rabbit hole, fire up your browser and start searching … Grrrr! Why am I the only one who wants to get the logs of a lambda invocations grouped together. What am I missing? Yes, I could install yet another library but no thank you - I just want my transaction log.</p>

<p>So I open a query on our development chat and a dear colleague of mine  comes to the rescue: Type <code class="highlighter-rouge">"RequestId: &lt;request-id-here&gt;"</code> in the search bar (including quotes). I was back in the game. And I could finally filter for the outer frame of the lambda invocation (START, END, and REPORT). But wait .. dude, where are <strong>MY</strong> logs? Why the hell would you (yes, you AWS - I am talking to you) prepend <strong>MY</strong> logs with the request id but then not show it together with the outer ones.</p>

<p>You got to be kidding me .. another frantic search across message boards and the world-wide-web. Finally a first hint two references across and hidden deep inside a <a href="https://github.com/aws/aws-sdk-js/issues/781#issuecomment-154499642">thread on a message board</a></p>

<p>Wait what .. could it be a simple pattern matching .. not RequestId as in ‘the Request ID of a lambda invocation’ but as in literally <code class="highlighter-rouge">RequestId: </code>?</p>

<p>And you might have guessed it, prepending my log with  <code class="highlighter-rouge">RequestId: </code> now makes it show up as part of the invocation.</p>

<p>So here is the magic syntax to log within your lambda function and make it searchable as part of the request in the CloudWatch console.</p>

<div class="language-text highlighter-rouge"><pre class="highlight"><code>export async function get(event, context) {

    console.log(
        "RequestId: " +
            context.awsRequestId +
            " UserId: " +
            userId +
            " Path: " +
            event.path +
            " Query: " +
            JSON.stringify(event.queryStringParameters)
</code></pre>
</div>

<p>May the (logging) power be strong in you.</p>

<h4 id="references">References</h4>
<ul>
  <li><a href="https://docs.aws.amazon.com/de_de/lambda/latest/dg/nodejs-prog-model-context.html]">https://docs.aws.amazon.com/de_de/lambda/latest/dg/nodejs-prog-model-context.html]</a></li>
  <li><a href="https://github.com/getndazn/dazn-lambda-powertools]">https://github.com/getndazn/dazn-lambda-powertools]</a></li>
  <li><a href="https://medium.com/hackernoon/centralised-logging-for-aws-lambda-b765b7ca9152]">https://medium.com/hackernoon/centralised-logging-for-aws-lambda-b765b7ca9152]</a></li>
</ul>

<hr />
<p>Update after a comment from my former colleague <a href="https://www.linkedin.com/in/diogo-henriques-4b77083a/">Diogo</a>:</p>

<p>He pointed me to the CloudWatch Insight console as an alternative method. After a couple of minutes of playing around I got the hang of it and it does indeed allow for filtering of the metadata of a log event such that all logs belonging to a single transaction can be shown.</p>

<p>At a basic level it is quite simple. You select the Log Group of your lambda endpoint, and then click together (or type) a filter expression like <code class="highlighter-rouge">filter @requestId="da1515da-09c8-4112-b50b-27a4bb04f058"</code>. Pay attention to the time period the query should cover.</p>

<h4 id="references-1">References</h4>
<ul>
  <li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html">https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData-discoverable-fields.html</a></li>
</ul>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'hlgr360'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="https://hlgr360.github.io/blog/blog/saas-on-aws-part-1/" class="btn" title="Building SaaS on AWS Serverless - Part 1">Previous</a>
      
      
        <a href="https://hlgr360.github.io/blog/blog/hello-fellow/" class="btn" title="Haufe Blog: Goodbye CTO, Hello Technical Fellow">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2020 Holger Reinhardt. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/so-simple-jekyll-theme/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="https://twitter.com/hlgr360" title="Holger Reinhardt on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	
	
	<a href="https://linkedin.com/in/hrreinhardt" title="Holger Reinhardt on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="https://www.slideshare.net/HolgerReinhardt" title="Holger Reinhardt on SlideShare" target="_blank"><i class="fa fa-slideshare fa-2x"></i></a>
	
	
	
	<a href="https://github.com/hlgr360" title="Holger Reinhardt on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="https://hlgr360.github.io/blog/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'https://hlgr360.github.io/blog';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://hlgr360.github.io/blog/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://hlgr360.github.io/blog/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-105145569-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



</body>
</html>
